C251 COMPILER V5.60.0,  zf_driver_delay                                                    11/06/25  16:16:29  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE zf_driver_delay
OBJECT MODULE PLACED IN .\out_file\zf_driver_delay.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\..\libraries\zf_driver\zf_driver_delay.c LARGE NOALIAS WARNINGLEVEL
                    -(3) OPTIMIZE(1,SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;..\
                    -..\libraries\zf_driver;..\user;..\code) DEBUG PRINT(.\out_file\zf_driver_delay.lst) TABS(2) OBJECT(.\out_file\zf_driver_
                    -delay.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2          * AI8051U Opensourec Library å³ï¼ˆAI8051U å¼€æºåº“ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå®˜æ–¹ SDK æ¥å£çš„ç¬¬ä¸‰æ–¹å¼€æº
             -åº“
    3          * Copyright (c) 2022 SEEKFREE é€é£ç§‘æŠ€
    4          *
    5          * æœ¬æ–‡ä»¶æ˜¯STC å¼€æºåº“çš„ä¸€éƒ¨åˆ†
    6          *
    7          * AI8051U å¼€æºåº“ æ˜¯å…è´¹è½¯ä»¶
    8          * æ‚¨å¯ä»¥æ ¹æ®è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒçš„ GPLï¼ˆGNU General Public Licenseï¼Œå³ GNUé€šç”¨å…¬å…±è®¸
             -å¯è¯ï¼‰çš„æ¡æ¬¾
    9          * å³ GPL çš„ç¬¬3ç‰ˆï¼ˆå³ GPL3.0ï¼‰æˆ–ï¼ˆæ‚¨é€‰æ‹©çš„ï¼‰ä»»ä½•åæ¥çš„ç‰ˆæœ¬ï¼Œé‡æ–°å‘å¸ƒå’Œ/æˆ–ä¿®æ”
             -¹å®ƒ
   10          *
   11          * æœ¬å¼€æºåº“çš„å‘å¸ƒæ˜¯å¸Œæœ›å®ƒèƒ½å‘æŒ¥ä½œç”¨ï¼Œä½†å¹¶æœªå¯¹å…¶ä½œä»»ä½•çš„ä¿è¯
   12          * ç”šè‡³æ²¡æœ‰éšå«çš„é€‚é”€æ€§æˆ–é€‚åˆç‰¹å®šç”¨é€”çš„ä¿è¯
   13          * æ›´å¤šç»†èŠ‚è¯·å‚è§ GPL
   14          *
   15          * æ‚¨åº”è¯¥åœ¨æ”¶åˆ°æœ¬å¼€æºåº“çš„åŒæ—¶æ”¶åˆ°ä¸€ä»½ GPL çš„å‰¯æœ¬
   16          * å¦‚æœæ²¡æœ‰ï¼Œè¯·å‚é˜…<https://www.gnu.org/licenses/>
   17          *
   18          * é¢å¤–æ³¨æ˜ï¼š
   19          * æœ¬å¼€æºåº“ä½¿ç”¨ GPL3.0 å¼€æºè®¸å¯è¯åè®® ä»¥ä¸Šè®¸å¯ç”³æ˜ä¸ºè¯‘æ–‡ç‰ˆæœ¬
   20          * è®¸å¯ç”³æ˜è‹±æ–‡ç‰ˆåœ¨ libraries/doc æ–‡ä»¶å¤¹ä¸‹çš„ GPL3_permission_statement.txt æ–‡ä»¶ä¸­
   21          * è®¸å¯è¯å‰¯æœ¬åœ¨ libraries æ–‡ä»¶å¤¹ä¸‹ å³è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ LICENSE æ–‡ä»¶
   22          * æ¬¢è¿å„ä½ä½¿ç”¨å¹¶ä¼ æ’­æœ¬ç¨‹åº ä½†ä¿®æ”¹å†…å®¹æ—¶å¿…é¡»ä¿ç•™é€é£ç§‘æŠ€çš„ç‰ˆæƒå£°æ˜ï¼ˆå³æœ¬
             -å£°æ˜ï¼‰
   23          *
   24          * æ–‡ä»¶åç§°          
   25          * å…¬å¸åç§°          æˆéƒ½é€é£ç§‘æŠ€æœ‰é™å…¬å¸
   26          * ç‰ˆæœ¬ä¿¡æ¯          æŸ¥çœ‹ libraries/doc æ–‡ä»¶å¤¹å†… version æ–‡ä»¶ ç‰ˆæœ¬è¯´æ˜
   27          * å¼€å‘ç¯å¢ƒ          MDK FOR C251
   28          * é€‚ç”¨å¹³å°          AI8051U
   29          * åº—é“ºé“¾æ¥          https://seekfree.taobao.com/
   30          *
   31          * ä¿®æ”¹è®°å½•
   32          * æ—¥æœŸ              ä½œè€…           å¤‡æ³¨
   33          * 2024-08-01        å¤§W            first version
   34          *********************************************************************************************************
             -***********/
   35          
   36          #include "zf_common_clock.h"
   37          #include "zf_driver_delay.h"
   38          
   39          
   40          static vuint16 pca_delay_1us = 0;
   41          static vuint16 pca_delay_1ms = 0;
   42          //-------------------------------------------------------------------------------------------------------
             -------------
   43          //  @brief      è½¯ä»¶å»¶æ—¶å‡½æ•°åˆå§‹åŒ–
   44          //  @param      NULL
   45          //  @return     void
   46          //  Sample usage:               æ— éœ€ç”¨æˆ·è°ƒç”¨ï¼Œç”¨æˆ·è¯·ä½¿ç”¨hæ–‡ä»¶ä¸­çš„å®å®šä¹‰
   47          //-------------------------------------------------------------------------------------------------------
             -------------
   48          void system_delay_init(void)
C251 COMPILER V5.60.0,  zf_driver_delay                                                    11/06/25  16:16:29  PAGE 2   

   49          {
   50   1        pca_delay_1ms = ((system_clock) / (1000));
   51   1        pca_delay_1us = ((system_clock) / (1000000));
   52   1        
   53   1        CCAPM0 = 0x48;      //PCA_2ä½œä¸ºè½¯ä»¶å»¶æ—¶
   54   1        CMOD = 0x03<<5 | 0x04 << 1;     //é¢‘ç‡=FSOC,å¼•è„šä¸ºç©ºï¼Œç¦æ­¢PCAä¸­æ–­
   55   1        CCON |= 1 << 6;     //å¯åŠ¨è®¡æ•°
   56   1          
   57   1      }
   58          
   59          //-------------------------------------------------------------------------------------------------------
             -------------
   60          //  @brief      å»¶æ—¶å‡½æ•°
   61          //  @param      ms              éœ€è¦å»¶æ—¶çš„æ—¶é—´ï¼ˆmsï¼‰
   62          //  @return     void
   63          //  Sample usage:               æ— éœ€ç”¨æˆ·è°ƒç”¨ï¼Œç”¨æˆ·è¯·ä½¿ç”¨hæ–‡ä»¶ä¸­çš„å®å®šä¹‰
   64          //-------------------------------------------------------------------------------------------------------
             -------------
   65          void system_delay_ms(uint16 ms)
   66          {
   67   1        uint16 temp;
   68   1      
   69   1        while(ms--)
   70   1        {
   71   2          temp = (CH<<8 | CL) + pca_delay_1ms;
   72   2        
   73   2          CCAP0L = temp;
   74   2          CCAP0H = (temp >> 8); 
   75   2          
   76   2          while((CCON & 0x01)  == 0);
   77   2          CCON &= ~0x01;
   78   2        }
   79   1      }
   80          
   81          //-------------------------------------------------------------------------------------------------------
             -------------
   82          //  @brief      å»¶æ—¶å‡½æ•°
   83          //  @param      us              éœ€è¦å»¶æ—¶çš„æ—¶é—´ï¼ˆusï¼‰
   84          //  @return     void
   85          //  Sample usage:               è¿™æ˜¯ä¸€ä¸ªä¸å¤ªå‡†çš„å‡½æ•°
   86          //-------------------------------------------------------------------------------------------------------
             -------------
   87          void system_delay_us(uint16 ms)
   88          {
   89   1        uint16 temp;
   90   1      
   91   1        while(ms--)
   92   1        {
   93   2          temp = (CH<<8 | CL) + pca_delay_1us;
   94   2        
   95   2          CCAP0L = temp;
   96   2          CCAP0H = (temp >> 8); 
   97   2          
   98   2          while((CCON & 0x01)  == 0);
   99   2          CCON &= ~0x01;
  100   2        }
  101   1      }


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       365     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =        12     ------
C251 COMPILER V5.60.0,  zf_driver_delay                                                    11/06/25  16:16:29  PAGE 3   

  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =        14     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
