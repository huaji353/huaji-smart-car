C251 COMPILER V5.60.0,  zf_device_tsl1401                                                  07/05/25  16:28:03  PAGE 1   


C251 COMPILER V5.60.0, COMPILATION OF MODULE zf_device_tsl1401
OBJECT MODULE PLACED IN .\out_file\zf_device_tsl1401.obj
COMPILER INVOKED BY: C:\Keil_v5\C251\BIN\C251.EXE ..\..\libraries\zf_device\zf_device_tsl1401.c LARGE NOALIAS WARNINGLEV
                    -EL(3) OPTIMIZE(0,SIZE) BROWSE INCDIR(..\..\libraries\zf_common;..\..\libraries\zf_components;..\..\libraries\zf_device;.
                    -.\..\libraries\zf_driver;..\user;..\code) DEBUG PRINT(.\out_file\zf_device_tsl1401.lst) TABS(2) OBJECT(.\out_file\zf_dev
                    -ice_tsl1401.obj) 

stmt  level    source

    1          /********************************************************************************************************
             -*************
    2          * AI8051U Opensourec Library å³ï¼ˆAI8051U å¼€æºåº“ï¼‰æ˜¯ä¸€ä¸ªåŸºäºå®˜æ–¹ SDK æ¥å£çš„ç¬¬ä¸‰æ–¹å¼€æº
             -åº“
    3          * Copyright (c) 2022 SEEKFREE é€é£ç§‘æŠ€
    4          *
    5          * æœ¬æ–‡ä»¶æ˜¯STC å¼€æºåº“çš„ä¸€éƒ¨åˆ†
    6          *
    7          * AI8051U å¼€æºåº“ æ˜¯å…è´¹è½¯ä»¶
    8          * æ‚¨å¯ä»¥æ ¹æ®è‡ªç”±è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒçš„ GPLï¼ˆGNU General Public Licenseï¼Œå³ GNUé€šç”¨å…¬å…±è®¸
             -å¯è¯ï¼‰çš„æ¡æ¬¾
    9          * å³ GPL çš„ç¬¬3ç‰ˆï¼ˆå³ GPL3.0ï¼‰æˆ–ï¼ˆæ‚¨é€‰æ‹©çš„ï¼‰ä»»ä½•åæ¥çš„ç‰ˆæœ¬ï¼Œé‡æ–°å‘å¸ƒå’Œ/æˆ–ä¿®æ”
             -¹å®ƒ
   10          *
   11          * æœ¬å¼€æºåº“çš„å‘å¸ƒæ˜¯å¸Œæœ›å®ƒèƒ½å‘æŒ¥ä½œç”¨ï¼Œä½†å¹¶æœªå¯¹å…¶ä½œä»»ä½•çš„ä¿è¯
   12          * ç”šè‡³æ²¡æœ‰éšå«çš„é€‚é”€æ€§æˆ–é€‚åˆç‰¹å®šç”¨é€”çš„ä¿è¯
   13          * æ›´å¤šç»†èŠ‚è¯·å‚è§ GPL
   14          *
   15          * æ‚¨åº”è¯¥åœ¨æ”¶åˆ°æœ¬å¼€æºåº“çš„åŒæ—¶æ”¶åˆ°ä¸€ä»½ GPL çš„å‰¯æœ¬
   16          * å¦‚æœæ²¡æœ‰ï¼Œè¯·å‚é˜…<https://www.gnu.org/licenses/>
   17          *
   18          * é¢å¤–æ³¨æ˜ï¼š
   19          * æœ¬å¼€æºåº“ä½¿ç”¨ GPL3.0 å¼€æºè®¸å¯è¯åè®® ä»¥ä¸Šè®¸å¯ç”³æ˜ä¸ºè¯‘æ–‡ç‰ˆæœ¬
   20          * è®¸å¯ç”³æ˜è‹±æ–‡ç‰ˆåœ¨ libraries/doc æ–‡ä»¶å¤¹ä¸‹çš„ GPL3_permission_statement.txt æ–‡ä»¶ä¸­
   21          * è®¸å¯è¯å‰¯æœ¬åœ¨ libraries æ–‡ä»¶å¤¹ä¸‹ å³è¯¥æ–‡ä»¶å¤¹ä¸‹çš„ LICENSE æ–‡ä»¶
   22          * æ¬¢è¿å„ä½ä½¿ç”¨å¹¶ä¼ æ’­æœ¬ç¨‹åº ä½†ä¿®æ”¹å†…å®¹æ—¶å¿…é¡»ä¿ç•™é€é£ç§‘æŠ€çš„ç‰ˆæƒå£°æ˜ï¼ˆå³æœ¬
             -å£°æ˜ï¼‰
   23          *
   24          * æ–‡ä»¶åç§°          
   25          * å…¬å¸åç§°          æˆéƒ½é€é£ç§‘æŠ€æœ‰é™å…¬å¸
   26          * ç‰ˆæœ¬ä¿¡æ¯          æŸ¥çœ‹ libraries/doc æ–‡ä»¶å¤¹å†… version æ–‡ä»¶ ç‰ˆæœ¬è¯´æ˜
   27          * å¼€å‘ç¯å¢ƒ          MDK FOR C251
   28          * é€‚ç”¨å¹³å°          AI8051U
   29          * åº—é“ºé“¾æ¥          https://seekfree.taobao.com/
   30          *
   31          * ä¿®æ”¹è®°å½•
   32          * æ—¥æœŸ              ä½œè€…           å¤‡æ³¨
   33          * 2024-08-01        å¤§W            first version
   34          *********************************************************************************************************
             -***********/
   35          /********************************************************************************************************
             -*************
   36          * æ¥çº¿å®šä¹‰ï¼š
   37          *                   ------------------------------------
   38          *                   æ¨¡å—ç®¡è„š            å•ç‰‡æœºç®¡è„š
   39          *                   CLK                 æŸ¥çœ‹ zf_device_tsl1401.h ä¸­ TSL1401_CLK_PIN å®å®šä¹‰
   40          *                   SI                  æŸ¥çœ‹ zf_device_tsl1401.h ä¸­ TSL1401_SI_PIN å®å®šä¹‰
   41          *                   AO[x]               æŸ¥çœ‹ zf_device_tsl1401.h ä¸­ TSL1401_AO_PIN_BUFFER å®å®šä¹‰
   42          *                   VCC                 3.3Vç”µæº
   43          *                   GND                 ç”µæºåœ°
   44          *                   ------------------------------------
   45          *********************************************************************************************************
             -***********/
   46          
   47          #include "zf_common_clock.h"
   48          #include "zf_common_debug.h"
C251 COMPILER V5.60.0,  zf_device_tsl1401                                                  07/05/25  16:28:03  PAGE 2   

   49          #include "zf_driver_adc.h"
   50          #include "zf_driver_delay.h"
   51          #include "zf_driver_gpio.h"
   52          #include "zf_driver_pit.h"
   53          
   54          #include "zf_device_tsl1401.h"
   55          
   56          uint16 tsl1401_data[2][TSL1401_DATA_LEN];                                       // TSL1401 æ•°æ®å­˜æ”¾æ•
             -°ç»„
   57          
   58          static uint8 tsl1401_init_state = 0;
   59          uint8 tsl1401_finish_flag;                                                      // TSL1401 æ•°æ®å‡†å¤‡å°
             -±ç»ªæ ‡å¿—ä½
   60          
   61          //-------------------------------------------------------------------------------------------------------
             -------------
   62          // å‡½æ•°ç®€ä»‹     TSL1401 çº¿é˜µ TSL1401 æ•°æ®é‡‡é›†
   63          // å‚æ•°è¯´æ˜     void
   64          // è¿”å›å‚æ•°     void
   65          // ä½¿ç”¨ç¤ºä¾‹     tsl1401_collect_pit_handler();
   66          // å¤‡æ³¨ä¿¡æ¯     è¯¥å‡½æ•°åœ¨ isr.c ä¸­å¯¹åº” TSL1401_PIT_INDEX çš„ä¸­æ–­æœåŠ¡å‡½æ•°è°ƒç”¨
   67          //-------------------------------------------------------------------------------------------------------
             -------------
   68          void tsl1401_collect_pit_handler (void)
   69          {
   70   1        uint8 i = 0;
   71   1        
   72   1          if(!tsl1401_init_state)
   73   1          {
   74   2              return;
   75   2          }
   76   1      
   77   1          TSL1401_CLK(1);
   78   1          TSL1401_SI(0);
   79   1          TSL1401_CLK(0);
   80   1          TSL1401_SI(1);
   81   1          TSL1401_CLK(1);
   82   1          TSL1401_SI(0);
   83   1      
   84   1          for(i = 0; i < TSL1401_DATA_LEN; i ++)
   85   1          {
   86   2              TSL1401_CLK(0);
   87   2              tsl1401_data[0][i] = adc_convert(TSL1401_AO_PIN);
   88   2              tsl1401_data[1][i] = adc_convert(TSL1401_AO_PIN2);
   89   2              TSL1401_CLK(1);
   90   2          }
   91   1          //é‡‡é›†å®Œæˆæ ‡å¿—ä½ç½®1
   92   1          tsl1401_finish_flag = 1;
   93   1      }
   94          
   95          //-------------------------------------------------------------------------------------------------------
             -------------
   96          // å‡½æ•°ç®€ä»‹     TSL1401 çº¿é˜µ CCD å›¾åƒå‘é€è‡³ä¸Šä½æœºæŸ¥çœ‹å›¾åƒ
   97          // å‚æ•°è¯´æ˜     uart_n          ä¸²å£å·
   98          // å‚æ•°è¯´æ˜     index           å¯¹åº”æ¥å…¥çš„å“ªä¸ª TSL1401 [0-1]
   99          // è¿”å›å‚æ•°     void
  100          // ä½¿ç”¨ç¤ºä¾‹     tsl1401_send_data(DEBUG_UART_INDEX, 1);
  101          // å¤‡æ³¨ä¿¡æ¯     è°ƒç”¨è¯¥å‡½æ•°å‰è¯·å…ˆåˆå§‹åŒ–ä¸²å£
  102          //-------------------------------------------------------------------------------------------------------
             -------------
  103          void tsl1401_send_data (uart_index_enum uart_n, uint8 index)
  104          {
  105   1          uint8 i;
  106   1      
  107   1          uart_write_byte(uart_n, 0x00);
  108   1          uart_write_byte(uart_n, 0xff);
C251 COMPILER V5.60.0,  zf_device_tsl1401                                                  07/05/25  16:28:03  PAGE 3   

  109   1          uart_write_byte(uart_n, 0x01);
  110   1          uart_write_byte(uart_n, 0x00);
  111   1      
  112   1          for(i=0; i<TSL1401_DATA_LEN; i++)
  113   1          {
  114   2              uart_write_byte(uart_n, (uint8)(tsl1401_data[index][i] >> 8));                   // å‘é€é«˜8ä½
  115   2              uart_write_byte(uart_n, (uint8)(tsl1401_data[index][i] & 0xFF));                 // å‘é€é«˜ä½8
             -ä½
  116   2          }
  117   1      }
  118          
  119          //-------------------------------------------------------------------------------------------------------
             -------------
  120          // å‡½æ•°ç®€ä»‹     TSL1401 çº¿é˜µ TSL1401 åˆå§‹åŒ–
  121          // å‚æ•°è¯´æ˜     void
  122          // è¿”å›å‚æ•°     void
  123          // ä½¿ç”¨ç¤ºä¾‹     tsl1401_init();
  124          // å¤‡æ³¨ä¿¡æ¯     
  125          //-------------------------------------------------------------------------------------------------------
             -------------
  126          void tsl1401_init (void)     
  127          {
  128   1          tsl1401_init_state = 1;
  129   1          adc_init(TSL1401_AO_PIN, TSL1401_AD_RESOLUTION);
  130   1          adc_init(TSL1401_AO_PIN2, TSL1401_AD_RESOLUTION);
  131   1          gpio_init(TSL1401_CLK_PIN, GPO, GPIO_LOW, GPO_PUSH_PULL);
  132   1          gpio_init(TSL1401_SI_PIN, GPO, GPIO_LOW, GPO_PUSH_PULL);
  133   1      }
  134          


Module Information          Static   Overlayable
------------------------------------------------
  code size            =       443     ------
  ecode size           =    ------     ------
  data size            =    ------     ------
  idata size           =    ------     ------
  pdata size           =    ------     ------
  xdata size           =       519     ------
  xdata-const size     =    ------     ------
  edata size           =    ------     ------
  bit size             =    ------     ------
  ebit size            =    ------     ------
  bitaddressable size  =    ------     ------
  ebitaddressable size =    ------     ------
  far data size        =    ------     ------
  huge data size       =    ------     ------
  const size           =    ------     ------
  hconst size          =         6     ------
End of Module Information.


C251 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
